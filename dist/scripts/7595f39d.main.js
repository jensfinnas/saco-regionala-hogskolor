function renderTemplate(a,b){for(key in b){var c=b[key],d=new RegExp("{{\\s?"+key+"\\s?}}","g");a=a.replace(d,c)}return a}Sankey=function(){function a(a,b){var c=this;c.data=c.formatData(b),c.container=d3.select(a);var d=c.container[0][0].offsetWidth;c.chartContainer=c.container.append("div").attr("class","chart"),c.margin=m={top:10,right:5,bottom:5,left:5},c.width=d-m.left-m.right,c.height=.7*c.width;var e=d3.format(",.0f");c.format=function(a){return e(a)+" "+units},c.color=d3.scale.category20(),c.drawCanvas(),c.initChart(),c.sentenceContainer=c.container.append("div").attr("class","sentence")}return a.prototype.formatData=function(a){var b={nodes:[],links:[]},c=[];return a.forEach(function(a){c.push({id:a.source_id,name:a.source_name,"class":a.source_class}),c.push({id:a.target_id,name:a.target_name,"class":a.target_class}),b.links.push({source:a.source_id,target:a.target_id,"class":a.target_class,value:+a.value})}),b.nodes=d3.keys(d3.nest().key(function(a){return a.id}).map(c)),b.links.forEach(function(a,c){b.links[c].source=b.nodes.indexOf(b.links[c].source),b.links[c].target=b.nodes.indexOf(b.links[c].target)}),b.nodes.forEach(function(a,d){b.nodes[d]=c.filter(function(b){return b.id==a})[0]}),b},a.prototype.drawCanvas=function(){var a=this,b=a.width,c=a.height,d=a.margin;a.svg=a.chartContainer.append("svg").attr("width",b+d.left+d.right).attr("height",c+d.top+d.bottom),a.chart=a.svg.append("g").attr("transform","translate("+d.left+","+d.top+")")},a.prototype.initChart=function(){var a=this,b=d3.sankey().nodeWidth(36).nodePadding(3).size([a.width,a.height]),c=b.link();b.nodes(a.data.nodes).links(a.data.links).layout(32);var d=a.chart.append("g").selectAll(".link").data(a.data.links).enter().append("path").attr("class",function(a){return"link "+a["class"]}).attr("d",c).style("stroke-width",function(a){return Math.max(1,a.dy)}).sort(function(a,b){return b.dy-a.dy}).on("mouseover",function(b){var c=a.getSentence(b);a.updateSentence(c)}).on("mouseout",function(b){a.updateSentence("")});d.append("title").text(function(b){return a.getSentence(b)});var e=a.chart.append("g").selectAll(".node").data(a.data.nodes).enter().append("g").attr("class",function(a){return"node "+a["class"]}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"});e.append("rect").attr("height",function(a){return a.dy}).attr("width",b.nodeWidth()).append("title").text(function(a){return a.name+"\n"+a.value}),e.append("text").attr("x",function(a){return-a.dy/2}).attr("y",function(a){return b.nodeWidth()/2}).attr("dy",".35em").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("class","label").text(function(a){return a.name})},a.prototype.updateSentence=function(a){var b=this;b.sentenceContainer.html(a)},a.prototype.getSentence=function(a){var b,c=a.target.id.split("_")[0],d={homeRegion:"Halland"};if("2"==c){var e=a.target.id.split("_")[1];d.value=Math.round(a.value/100*100),d.studyRegion="home"==e?"i "+d.homeRegion:"på annan ort",b="{{ value }} procent av alla högskolestudenter från {{ homeRegion }} började studera {{ studyRegion }}."}else if("3"==c){var e=a.source.id.split("_")[1],f=a.target.id.split("_")[1];d.value=Math.round(a.value/a.source.value*100),d.studyRegion="home"==e?"i "+d.homeRegion:"på annan ort",d.liveRegion="home"==f?"i "+d.homeRegion:"på annan ort",b="Av de studenter från {{ homeRegion }} som studerade {{ studyRegion }} ",b+=f==e&&"home"==f?"bodde {{ value }} procent kvar i länet efter 10 år.":"home"!=e&&"home"==f?"återvände {{ value }} procent till {{ homeRegion }}.":"home"==e&&"home"!=f?"flyttade {{ value }} procent till annan ort.":"bodde {{ value }} procent kvar utanför länet."}return renderTemplate(b,d)},a}(),console.log("'Allo 'Allo!");